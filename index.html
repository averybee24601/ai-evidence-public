<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Unified Evidence Dashboard</title>
    <style>
        :root {
            --sidebar-bg: #1e293b;
            --sidebar-text: #e2e8f0;
            --main-bg: #f1f5f9;
            --card-bg: #ffffff;
            --accent: #3b82f6;
            --text-primary: #1e293b;
            --text-secondary: #64748b;
            --border: #e2e8f0;
        }

        * { box-sizing: border-box; }

        body {
            margin: 0;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            display: flex;
            height: 100vh;
            background-color: var(--main-bg);
            color: var(--text-primary);
            overflow: hidden;
        }

        /* Sidebar */
        #sidebar {
            width: 280px;
            background-color: var(--sidebar-bg);
            color: var(--sidebar-text);
            display: flex;
            flex-direction: column;
            flex-shrink: 0;
        }

        .sidebar-header {
            padding: 20px;
            font-size: 1.25rem;
            font-weight: 700;
            border-bottom: 1px solid #334155;
            background: #0f172a;
        }

        .nav-links {
            flex: 1;
            overflow-y: auto;
            padding: 10px 0;
        }

        .nav-category {
            padding: 12px 20px;
            cursor: pointer;
            font-size: 0.95rem;
            border-left: 4px solid transparent;
            transition: all 0.2s;
            color: #94a3b8;
        }

        .nav-category:hover {
            background-color: #334155;
            color: #fff;
        }

        .nav-category.active {
            background-color: #334155;
            color: #fff;
            border-left-color: var(--accent);
        }

        /* Main Content */
        #main {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .header {
            padding: 20px 40px;
            background: var(--card-bg);
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 { margin: 0; font-size: 1.5rem; }
        .header-meta { font-size: 0.875rem; color: var(--text-secondary); }

        .content-scroll {
            padding: 40px;
            overflow-y: auto;
            flex: 1;
        }

        .section-title {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 10px;
            color: var(--text-primary);
        }

        .section-desc {
            margin-bottom: 30px;
            color: var(--text-secondary);
            max-width: 800px;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 24px;
        }

        /* Cards */
        .case-card {
            background: var(--card-bg);
            border-radius: 12px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            transition: transform 0.2s, box-shadow 0.2s;
            cursor: pointer;
            border: 1px solid var(--border);
            display: flex;
            flex-direction: column;
        }

        .case-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }

        .card-thumb {
            height: 180px;
            background: #e2e8f0;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .card-thumb img, .card-thumb video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .card-type-badge {
            position: absolute;
            top: 12px;
            right: 12px;
            background: rgba(0,0,0,0.75);
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .card-body {
            padding: 20px;
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .card-title {
            font-weight: 600;
            font-size: 1.1rem;
            margin-bottom: 8px;
            line-height: 1.4;
        }

        .card-meta {
            font-size: 0.875rem;
            color: var(--text-secondary);
            margin-bottom: 16px;
        }

        .btn-open {
            margin-top: auto;
            background: var(--text-primary);
            color: white;
            border: none;
            padding: 10px;
            border-radius: 6px;
            font-weight: 500;
            cursor: pointer;
            transition: background 0.2s;
            width: 100%;
            text-align: center;
        }

        .btn-open:hover { background: var(--accent); }

        /* Modal Popup */
        .modal-overlay {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(15, 23, 42, 0.8);
            backdrop-filter: blur(4px);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal-window {
            background: var(--card-bg);
            width: 95%;
            max-width: 1400px;
            height: 90vh;
            border-radius: 16px;
            display: flex;
            overflow: hidden;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        }

        .modal-sidebar {
            width: 350px;
            background: #f8fafc;
            border-right: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            padding: 24px;
            overflow-y: auto;
        }

        .modal-main {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: white;
            overflow: hidden;
        }

        .modal-header {
            padding: 20px 30px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title { font-size: 1.5rem; font-weight: 700; }

        .btn-close {
            background: none; border: none; font-size: 1.5rem; cursor: pointer; color: var(--text-secondary);
        }

        .modal-content-area {
            flex: 1;
            overflow-y: auto;
            padding: 30px;
            display: flex;
            gap: 30px;
        }

        .evidence-viewer {
            flex: 2;
            min-width: 0; /* Prevent flex overflow */
        }

        .analysis-panel {
            flex: 1;
            background: #f8fafc;
            border-radius: 8px;
            border: 1px solid var(--border);
            padding: 20px;
            height: fit-content;
        }

        .section-label {
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 700;
            color: var(--text-secondary);
            margin-bottom: 10px;
            display: block;
        }

        .profile-chip {
            display: flex;
            align-items: center;
            gap: 10px;
            background: white;
            padding: 8px;
            border-radius: 6px;
            border: 1px solid var(--border);
            margin-bottom: 8px;
        }

        .profile-chip img {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            object-fit: cover;
        }

        .doc-link {
            display: block;
            padding: 10px;
            background: white;
            border: 1px solid var(--border);
            border-radius: 6px;
            text-decoration: none;
            color: var(--accent);
            margin-bottom: 8px;
            font-size: 0.9rem;
            transition: all 0.2s;
        }

        .doc-link:hover { border-color: var(--accent); background: #eff6ff; }

        .report-text {
            white-space: pre-wrap;
            font-family: 'Georgia', serif;
            line-height: 1.6;
            color: #334155;
            font-size: 1rem;
        }

        .tag {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.75rem;
            background: #e2e8f0;
            color: #475569;
            margin-right: 4px;
        }

        /* Mobile responsiveness */
        @media (max-width: 1024px) {
            .modal-content-area { flex-direction: column; }
            .modal-window { flex-direction: column; }
            .modal-sidebar { width: 100%; height: 200px; order: 2; }
            .modal-main { order: 1; height: 60%; }
        }
    </style>
</head>
<body>

<div id="sidebar">
    <div class="sidebar-header">
        Evidence Portal
    </div>
    <div class="nav-links" id="navLinks">
        <!-- Injected via JS -->
    </div>
</div>

<div id="main">
    <div class="header">
        <h1>Case Files Dashboard</h1>
        <div class="header-meta">Unified Evidence Repository</div>
    </div>
    <div class="content-scroll" id="contentArea">
        <!-- Injected via JS -->
    </div>
</div>

<!-- Modal -->
<div class="modal-overlay" id="caseModal">
    <div class="modal-window">
        <div class="modal-main">
            <div class="modal-header">
                <div class="modal-title" id="mTitle">Case Title</div>
                <button class="btn-close" onclick="closeModal()">√ó</button>
            </div>
            <div class="modal-content-area">
                <div class="evidence-viewer" id="mEvidence">
                    <!-- Video/Image goes here -->
                </div>
                <div class="analysis-panel">
                    <span class="section-label">Analysis Report</span>
                    <div class="report-text" id="mReport">Loading analysis...</div>
                </div>
            </div>
        </div>
        <div class="modal-sidebar">
            <div style="margin-bottom: 24px;">
                <span class="section-label">Involved Profiles</span>
                <div id="mProfiles"></div>
            </div>
            <div style="margin-bottom: 24px;">
                <span class="section-label">Related Final Reports</span>
                <div id="mFinalReports"></div>
            </div>
            <div>
                <span class="section-label">Related Testimonies</span>
                <div id="mTestimonies"></div>
            </div>
        </div>
    </div>
</div>

<script>
    const GITHUB_BASE = 'https://raw.githubusercontent.com/averybee24601/ai-evidence-public/main/';

    // Data Store
    const data = {
        categories: [
            { id: 'alcohol', label: 'Alcohol Violations', desc: 'Documentation of management drinking on duty and promotion of hard liquor.' },
            { id: 'sexual', label: 'Sexual Misconduct', desc: 'Evidence of sexualized performances and adult content.' },
            { id: 'exploitation', label: 'Exploitation & Coercion', desc: 'Unauthorized recording and potential exploitation of vulnerable staff.' },
            { id: 'discrimination', label: 'Discrimination', desc: 'Retaliatory scheduling, hours reduction, and dismissive conduct.' },
            { id: 'unsafe', label: 'Unsafe Conditions', desc: 'Inaccessible environments and ignored safety concerns.' },
            { id: 'misrepresentation', label: 'Misrepresentation', desc: 'Deceptive marketing and political ideology promotion.' },
            { id: 'final', label: 'Global Reports', desc: 'Comprehensive final reports and official complaints.' }
        ],
        cases: [
            // Alcohol
            {
                id: 'c1', cat: 'alcohol', title: 'Management Drinking on Duty',
                evidence: 'data/Analyzed files/trimmed-Management drinking (3).mp4',
                report: 'data/AR/Analysis of trimmed-Management drinking (3).mp4 (2).txt',
                type: 'video',
                profiles: ['Jess', 'Connor']
            },
            {
                id: 'c2', cat: 'alcohol', title: 'Liquor Promotion & Menu',
                evidence: 'data/Analyzed files/menu promotion of hard liqour based cocktails.jpg',
                report: 'data/AR/Analysis of menu promotion of hard liqour based cocktails.jpg + hard liqour, cocktails spirits.jpg + social media post advertising wine products.jpg (2).txt',
                type: 'image',
                profiles: ['Tiffany Fixter']
            },
            // Sexual
            {
                id: 'c3', cat: 'sexual', title: 'Magic Mike Performance',
                evidence: 'data/Analyzed files/Magic mike Jose.mp4',
                report: 'data/AR/Analysis of Magic mike Jose.mp4.txt',
                type: 'video',
                profiles: ['Jose', 'Tiffany Fixter']
            },
            {
                id: 'c4', cat: 'sexual', title: 'Girls Night Out Event',
                evidence: 'data/Analyzed files/Girls night out.png',
                report: 'data/AR/Analysis_Girls_night_out_combined_full.txt',
                type: 'image',
                profiles: ['Jose']
            },
            // Exploitation
            {
                id: 'c5', cat: 'exploitation', title: 'Unauthorized Youtube Footage',
                evidence: 'data/Analyzed files/video_unauthorized_youtube_footage.mp4',
                report: 'data/AR/Analysis of video_unauthorized_youtube_footage.mp4.txt',
                type: 'video',
                profiles: ['Tiffany Fixter']
            },
            {
                id: 'c6', cat: 'exploitation', title: 'Inappropriate Physical Contact',
                evidence: 'data/Analyzed files/photo_person_sitting_on_person_brewability_stage.png',
                report: 'data/AR/Analysis of photo_person_sitting_on_person_brewability_stage.png.txt',
                type: 'image',
                profiles: []
            },
            // Discrimination
            {
                id: 'c7', cat: 'discrimination', title: 'Retaliatory Hours Cut',
                evidence: 'data/Analyzed files/Retaliatory hours cut due to refusal to ban caregiver - Copy.jpg',
                report: 'data/AR/Analysis of Retaliatory hours cut due to refusal to ban caregiver - Copy.jpg.txt',
                type: 'image',
                profiles: ['Tiffany Fixter', 'Avery Becker']
            },
            {
                id: 'c8', cat: 'discrimination', title: 'Dismissive Text Messages',
                evidence: 'data/Analyzed files/text.png',
                report: 'data/AR/Analysis of text.png.txt',
                type: 'image',
                profiles: ['Tiffany Fixter', 'Juliana']
            },
            // Unsafe
            {
                id: 'c9', cat: 'unsafe', title: 'Inaccessible Environment',
                evidence: 'data/Analyzed files/inaccessible work environment.jpg',
                report: 'data/AR/Analysis of inaccessible work environment.jpg.txt',
                type: 'image',
                profiles: ['Connor']
            },
            // Misrepresentation
            {
                id: 'c10', cat: 'misrepresentation', title: 'Political Ideology Promotion',
                evidence: 'data/Analyzed files/brewability political ideology promotion.png',
                report: 'data/AR/Analysis of brewability political ideology promotion.png.txt',
                type: 'image',
                profiles: []
            }
        ],
        profiles: [
            { name: 'Tiffany Fixter', img: 'data/Profiles/Tiffany Fixter.reference.png', role: 'Owner' },
            { name: 'Jess', img: 'data/Profiles/Jess.reference.png', role: 'Manager' },
            { name: 'Jose', img: 'data/Profiles/Jose.reference.png', role: 'Staff' },
            { name: 'Juliana', img: 'data/Profiles/Juliana.reference.png', role: 'Staff' },
            { name: 'Connor', img: 'data/Profiles/Connor.reference.png', role: 'Staff' },
            { name: 'Avery Becker', img: 'data/Profiles/Avery Becker.reference.png', role: 'Staff' }
        ],
        reports: [
            { title: 'Comprehensive Analysis', path: 'data/Final Reports/COMPREHENSIVE ANALYSIS - Brewability Workplace Misconduct and Exploitation.txt' },
            { title: 'Executive Summary', path: 'data/Final Reports/EXECUTIVE SUMMARY - Key Findings and Evidence.txt' },
            { title: 'Timeline of Exploitation', path: 'data/Final Reports/TIMELINE - Chronological Pattern of Exploitation.txt' },
            { title: 'Formal Licensing Complaint', path: 'data/Final Reports/FORMAL COMPLAINT TO THE ENGLEWOOD LOCAL LICENSING AUTHORITY.TXT' }
        ],
        testimonies: [
            { title: 'Testimony - Juliana', path: 'data/Testimonies/Employee Testimony - Juliana.txt' },
            { title: 'Testimony - Avery', path: 'data/Testimonies/My Testimony.txt' }
        ]
    };

    // App Logic
    function init() {
        renderSidebar();
        renderCategory('alcohol'); // Default view
    }

    function renderSidebar() {
        const nav = document.getElementById('navLinks');
        data.categories.forEach(cat => {
            const div = document.createElement('div');
            div.className = 'nav-category';
            div.innerText = cat.label;
            div.onclick = () => renderCategory(cat.id);
            div.id = `nav-${cat.id}`;
            nav.appendChild(div);
        });
    }

    function renderCategory(catId) {
        // Update Nav
        document.querySelectorAll('.nav-category').forEach(el => el.classList.remove('active'));
        document.getElementById(`nav-${catId}`).classList.add('active');

        const container = document.getElementById('contentArea');
        container.innerHTML = '';

        const cat = data.categories.find(c => c.id === catId);
        
        // Header
        const header = document.createElement('div');
        header.innerHTML = `
            <div class="section-title">${cat.label}</div>
            <div class="section-desc">${cat.desc}</div>
        `;
        container.appendChild(header);

        // Grid
        const grid = document.createElement('div');
        grid.className = 'grid';

        // Filter Cases
        if (catId === 'final') {
            // Special render for Global Reports
            data.reports.forEach(rep => {
                const card = createDocCard(rep, 'Final Report');
                grid.appendChild(card);
            });
            data.testimonies.forEach(test => {
                const card = createDocCard(test, 'Testimony');
                grid.appendChild(card);
            });
        } else {
            const cases = data.cases.filter(c => c.cat === catId);
            cases.forEach(c => {
                const card = createCaseCard(c);
                grid.appendChild(card);
            });
        }

        container.appendChild(grid);
    }

    function createCaseCard(c) {
        const div = document.createElement('div');
        div.className = 'case-card';
        div.onclick = () => openModal(c);

        let thumbContent = '';
        const url = GITHUB_BASE + encodeURI(c.evidence);

        if (c.type === 'video') {
            thumbContent = `<video src="${url}#t=1" muted preload="metadata"></video>`; // Show frame 1
        } else {
            thumbContent = `<img src="${url}" alt="${c.title}">`;
        }

        div.innerHTML = `
            <div class="card-thumb">
                ${thumbContent}
                <div class="card-type-badge">${c.type}</div>
            </div>
            <div class="card-body">
                <div class="card-title">${c.title}</div>
                <div class="card-meta">Unified Evidence File</div>
                <button class="btn-open">Open Case File</button>
            </div>
        `;
        return div;
    }

    function createDocCard(doc, type) {
        const div = document.createElement('div');
        div.className = 'case-card';
        div.onclick = () => window.open(GITHUB_BASE + encodeURI(doc.path), '_blank');
        
        div.innerHTML = `
            <div class="card-body">
                <div class="card-type-badge" style="position:static; margin-bottom:10px; display:inline-block; background:#3b82f6;">${type}</div>
                <div class="card-title">${doc.title}</div>
                <div class="card-meta">Click to view full document</div>
                <button class="btn-open">View Document</button>
            </div>
        `;
        return div;
    }

    // Modal Logic
    async function openModal(c) {
        const modal = document.getElementById('caseModal');
        modal.style.display = 'flex';
        document.getElementById('mTitle').innerText = c.title;

        // Load Evidence
        const evContainer = document.getElementById('mEvidence');
        const url = GITHUB_BASE + encodeURI(c.evidence);
        if (c.type === 'video') {
            evContainer.innerHTML = `<video src="${url}" controls style="width:100%; max-height:500px; background:black; border-radius:8px;"></video>`;
        } else {
            evContainer.innerHTML = `<img src="${url}" style="width:100%; max-height:500px; object-fit:contain; border-radius:8px;">`;
        }

        // Load Report
        const repContainer = document.getElementById('mReport');
        repContainer.innerText = 'Loading...';
        try {
            const repUrl = GITHUB_BASE + encodeURI(c.report);
            const res = await fetch(repUrl);
            if(!res.ok) throw new Error('Failed to load');
            const text = await res.text();
            repContainer.innerText = text;
        } catch (e) {
            repContainer.innerText = 'Error loading analysis report. Please check connection.';
        }

        // Load Profiles
        const profContainer = document.getElementById('mProfiles');
        profContainer.innerHTML = '';
        c.profiles.forEach(pName => {
            const p = data.profiles.find(x => x.name === pName);
            if (p) {
                const pUrl = GITHUB_BASE + encodeURI(p.img);
                profContainer.innerHTML += `
                    <div class="profile-chip">
                        <img src="${pUrl}">
                        <div>
                            <div style="font-weight:600; font-size:0.9rem;">${p.name}</div>
                            <div style="font-size:0.75rem; color:#64748b;">${p.role}</div>
                        </div>
                    </div>
                `;
            }
        });

        // Load Related Documents (Final Reports link)
        const finalContainer = document.getElementById('mFinalReports');
        finalContainer.innerHTML = '';
        data.reports.forEach(rep => {
            const rUrl = GITHUB_BASE + encodeURI(rep.path);
            finalContainer.innerHTML += `<a href="${rUrl}" target="_blank" class="doc-link">üìÑ ${rep.title}</a>`;
        });

        const testContainer = document.getElementById('mTestimonies');
        testContainer.innerHTML = '';
        data.testimonies.forEach(test => {
             const tUrl = GITHUB_BASE + encodeURI(test.path);
             testContainer.innerHTML += `<a href="${tUrl}" target="_blank" class="doc-link">üó£Ô∏è ${test.title}</a>`;
        });
    }

    function closeModal() {
        document.getElementById('caseModal').style.display = 'none';
        document.getElementById('mEvidence').innerHTML = ''; // Stop video
    }

    // Close on outside click
    document.getElementById('caseModal').addEventListener('click', (e) => {
        if (e.target.id === 'caseModal') closeModal();
    });

    init();

</script>

</body>
</html>
